@using Microsoft.AspNetCore.Identity
@using Models.Models
@using Utilities.Constants
@inject SignInManager<User> SignInManager
@inject IHttpContextAccessor Accessor
@inject UserManager<User> UserManager
@{
    var userString = Accessor.HttpContext.Session.GetString("CurrentUser");
    User currentUser = null;
    if (userString != null)
    {
        currentUser = System.Text.Json.JsonSerializer.Deserialize<User>(userString);
    }
}

<nav class="bg-white border-b border-gray-200 fixed w-full top-0 z-50">
    <div class="container mx-auto flex items-center justify-between px-6 py-3">
        <!-- Logo -->
        <a href="/" class="flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-green-500" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 2C8.134 2 5 5.134 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.866-3.134-7-7-7z" />
                <circle cx="12" cy="9" r="2.5" fill="currentColor" />
            </svg>
            <span class="text-xl font-bold text-blue-600">Travel</span>
            <span class="text-xl font-bold text-green-500">Ties</span>
        </a>

        <!-- Menu -->
        <div class="flex items-center space-x-6">
            <a href="/" class="flex items-center text-sm font-medium text-blue-600 hover:text-green-500">
                <i class="fas fa-home mr-1"></i> Trang ch·ªß
            </a>

            <a asp-area="Customer" asp-action="Index" asp-controller="Tour"
               class="text-sm font-medium text-gray-700 hover:text-green-500">Tours</a>

            <a asp-area="Customer" asp-controller="Tour" asp-action="Deals"
               class="text-sm font-medium text-gray-700 hover:text-green-500">∆Øu ƒë√£i</a>

            <a asp-area="Customer" asp-controller="Tour" asp-action="Featured"
               class="flex items-center text-sm font-medium text-gray-700 hover:text-green-500">
                <i class="far fa-star mr-1"></i> N·ªïi b·∫≠t
            </a>

            <a href="/support" class="text-sm font-medium text-gray-700 hover:text-green-500">H·ªó tr·ª£</a>

            <!-- N√∫t Chat (gi·ªØ style ƒë·ªìng b·ªô) 
            <a asp-area="Customer" asp-controller="Chat" asp-action="Index"
               class="px-3 py-1.5 border border-gray-300 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 transition flex items-center gap-1">
                <span aria-hidden="true">üí¨</span> Chat
            </a>-->
        </div>

        <!-- Right Actions -->
        <div class="flex items-center space-x-4">
            <!-- Language -->
            <button class="flex items-center text-sm font-medium text-gray-700 hover:text-green-500">
                <i class="fas fa-globe mr-1"></i> VN
            </button>

            @if (SignInManager.IsSignedIn(User))
            {
                var isCompany = User.IsInRole(RoleConstants.Company);
                var isAdmin = User.IsInRole(RoleConstants.Admin);

                <div class="dropdown dropdown-end">
                    <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
                        <div class="w-10 rounded-full">
                            <img src="@(currentUser?.UserAvatar ?? @Url.Content("images/default-avatar.png"))" alt="@currentUser?.UserName" />
                        </div>
                    </div>
                    <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-white text-black rounded-box w-52">
                        <li class="menu-title flex items-center gap-2">
                            <span>@currentUser?.UserName</span>
                            @if (isCompany)
                            {
                                <span class="badge badge-primary badge-sm">Company</span>
                            }
                            else if (isAdmin)
                            {
                                <span class="badge badge-warning badge-sm">Admin</span>
                            }
                            else
                            {
                                <span class="badge badge-warning badge-sm">User</span>
                            }
                        </li>
                        @if (isCompany)
                        {
                            <li><a asp-area="Company" asp-action="Index" asp-controller="Company">ƒê·∫°i l√≠ c·ªßa b·∫°n</a></li>
                            <li><a asp-area="Company" asp-action="CompanyProfile" asp-controller="Company">H·ªì s∆° ƒë·∫°i l√≠</a></li>
                        }
                        else if (isAdmin)
                        {
                            <li><a asp-area="Admin" asp-controller="Admin" asp-action="Dashboard">Tr·ªü v·ªÅ Admin Control</a></li>
                        }
                        else
                        {
                            <li><a asp-area="Customer" asp-controller="Profile" asp-action="Index">H·ªì s∆° c·ªßa b·∫°n</a></li>
                            <li><a asp-area="Customer" asp-controller="Ticket" asp-action="Index">V√© c·ªßa b·∫°n</a></li>
                        }
                        <li><a asp-area="Identity" asp-action="Logout" asp-controller="Auth">ƒêƒÉng xu·∫•t</a></li>
                    </ul>
                </div>
            }
            else
            {
                <a asp-area="Identity" asp-page="/Account/Login"
                   class="px-4 py-1.5 border border-gray-300 text-sm font-medium text-gray-700 rounded-md flex items-center hover:bg-gray-100 transition">
                    <i class="fas fa-user mr-1"></i> ƒêƒÉng nh·∫≠p
                </a>
            }
        </div>
    </div>
</nav>
